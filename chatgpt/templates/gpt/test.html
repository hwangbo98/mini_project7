<!-- chatbot/templates/chatbot/chat.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Chat with our bot</h1>
    <div id="chatbox">
        <div id="messages"></div>
        <input type="text" id="message" placeholder="Type a message...">
        <button id="send">Send</button>
        <button id="new-chat">New Chat</button>
    </div>

    <script>
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
        });
        $('#send').click(function() {
            var message = $('#message').val();
            $.post('test', {message: message}, function(data) {
                $('#messages').append('<p><strong>You:</strong> ' + message + '</p>');
                $('#messages').append('<p><strong>Bot:</strong> ' + data.response + '</p>');

                // 소스 문서 출력
                if (data.source_documents) {
                    $('#messages').append('<p><strong>Sources:</strong></p>');
                    data.source_documents.forEach(function(doc, index) {
                        $('#messages').append('<p>Source ' + (index + 1) + ': ' + doc + '</p>');
                    });
                }

                $('#message').val('');
            });
        });

        $('#new-chat').click(function() {
            $.get('test', {new_chat: 'true'}, function() {
                $('#messages').html('<p>New chat started.</p>');
            });
        });
    </script>
</body>
</html>
